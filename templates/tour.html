<!doctype html>

<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

<style>
  body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  .container {
    max-width: 900px;
  }

  h1,
  h2,
  h3 {
    color: #f8f9fa;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .card {
    background-color: #292929;
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: transform 0.2s ease-in-out;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .form-label {
    color: #ced4da;
    font-weight: 500;
  }

  .form-control,
  .form-select {
    background-color: #333;
    color: #fff;
    border: 1px solid #444;
  }

  .form-control:focus,
  .form-select:focus {
    background-color: #444;
    color: #fff;
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  .btn-success,
  .btn-primary,
  .btn-secondary {
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }

  .btn-secondary:hover {
    filter: brightness(1.2);
  }

  .alert {
    border-radius: 8px;
  }

  .file-preview {
    max-width: 200px;
    max-height: 200px;
    border: 1px solid #555;
    margin-right: 10px;
    border-radius: 8px;
  }

  table td {
    vertical-align: middle;
  }

  .preview {
    display: inline-block;
    margin: 5px;
    text-align: center;
  }

  .video-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    padding: 1rem 0;
  }

  .video-card {
    background: #1f1f1f;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    width: 200px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out;
    border: 1px solid #333;
  }

  .video-card:hover {
    transform: scale(1.05);
  }

  .video-card .ranking {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #ddd;
    font-family: "Helvetica Neue", Arial, sans-serif;
  }

  .small-video {
    width: 180px;
    height: auto;
    border-radius: 8px;
  }
  
  .small-image {
    width: 180px;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
  }

  .loading-placeholder {
    background: #333;
    width: 180px;
    height: 180px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
  }

  .btn-success::before {
    font-family: "Font Awesome 6 Free";
    content: "\f067";
    margin-right: 0.5rem;
    font-weight: 900;
  }

  .btn-primary::before {
    font-family: "Font Awesome 6 Free";
    content: "\f044";
    margin-right: 0.5rem;
    font-weight: 900;
  }

  .btn-secondary::before {
    font-family: "Font Awesome 6 Free";
    content: "\f015";
    margin-right: 0.5rem;
    font-weight: 900;
  }
  
  /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ø¯Ø§ÙƒÙ†Ø© ÙˆØµØºÙŠØ±Ø© */
  .btn-custom-rename,
  .btn-custom-delete {
    padding: 0.25rem 0.6rem; /* Ø£ØµØºØ± Padding */
    font-size: 0.8rem; /* Ø®Ø· Ø£ØµØºØ± */
    border-radius: 6px; /* Ø­ÙˆØ§Ù Ø£ÙƒØ«Ø± Ø§Ø³ØªØ¯Ø§Ø±Ø© Ø¨Ù‚Ù„ÙŠÙ„ */
    font-weight: 500;
    transition: all 0.2s ease-in-out;
    display: inline-flex; /* Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Øµ Ù…ØªØ¬Ø§ÙˆØ±ÙŠÙ† */
    align-items: center; /* Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù…ÙˆØ¯ÙŠØ© */
    white-space: nowrap; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø§Ù„ØªÙØ§Ù */
    margin-right: 5px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªØ¬Ø§ÙˆØ±Ø© */
  }

  .btn-custom-rename {
    background-color: #4a4a4a; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† Ù„Ù„Ø®Ù„ÙÙŠØ© */
    border-color: #555; /* Ø­Ø¯ÙˆØ¯ Ø£ØºÙ…Ù‚ */
    color: #e0e0e0; /* Ù„ÙˆÙ† Ù†Øµ ÙØ§ØªØ­ */
  }

  .btn-custom-rename:hover {
    background-color: #5a5a5a; /* Ù„ÙˆÙ† Ø£ÙØªØ­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
    border-color: #666;
    color: #fff;
  }

  .btn-custom-delete {
    background-color: #8b0000; /* Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† Ù„Ù„Ø­Ø°Ù */
    border-color: #a00000; /* Ø­Ø¯ÙˆØ¯ Ø£ØºÙ…Ù‚ */
    color: #e0e0e0;
  }

  .btn-custom-delete:hover {
    background-color: #a00000; /* Ø£Ø­Ù…Ø± Ø£ÙØªØ­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
    border-color: #b00000;
    color: #fff;
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
  .btn-custom-rename .fas,
  .btn-custom-delete .fas {
    margin-right: 0.3rem; /* Ù…Ø³Ø§ÙØ© Ø£Ù‚Ù„ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    font-size: 0.7rem; /* Ø­Ø¬Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§ */
  }

  .tournament-name {
    font-size: 1.2rem;
    color: #bbb;
    font-weight: 600;
    font-family: "Roboto", sans-serif;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    flex-wrap: wrap; 
  }
  .tournament-name form {
      margin-left: 10px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
      margin-top: 5px; /* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ø°Ø§ Ù†Ø²Ù„Øª Ù„Ø£Ø³ÙÙ„ */
      white-space: nowrap; 
  }

  .home-button-container {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
  }
</style>
  </head>

  <body class="dark-mode">
    <div class="home-button-container">
      <a href="{{ url_for('index') }}" class="btn btn-secondary"
        >Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a
      >
    </div>
    <div class="container mt-5">
      <h1 class="text-center mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h1>

      <!-- Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¹Ø±Ø¶ -->
      <div class="card mb-4">
        <div class="card-body">
          <h5>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨</h5>
          <form method="POST">
            <div class="row">
              <div class="col-md-6">
                <label for="view_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶:</label>
                <select class="form-select" name="view_type" id="view_type">
                  <option value="tournaments" {% if current_view == 'tournaments' %}selected{% endif %}>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</option>
                  <option value="videos" {% if current_view == 'videos' %}selected{% endif %}>Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="sort_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªØ±ØªÙŠØ¨:</label>
                <select class="form-select" name="sort_type" id="sort_type">
                  <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                  <option value="asc_weight" {% if current_sort == 'asc_weight' %}selected{% endif %}>ØªØµØ§Ø¹Ø¯ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†</option>
                  <option value="desc_weight" {% if current_sort == 'desc_weight' %}selected{% endif %}>ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†</option>
                  <option value="most_frequent" {% if current_sort == 'most_frequent' %}selected{% endif %}>Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn btn-primary mt-2">ØªØ·Ø¨ÙŠÙ‚</button>
          </form>
        </div>
      </div>
      <!-- Ù†Ù‡Ø§ÙŠØ© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¹Ø±Ø¶ -->

{% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <div class="mb-4">
    {% for category, message in messages %}
    <div
      class="alert alert-{{ category }} alert-dismissible fade show"
      role="alert"
    >
      {{ message }}
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="alert"
      ></button>
    </div>
    {% endfor %}
  </div>
  {% endif %} {% endwith %}

  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <form action="{{ url_for('tour_create') }}" method="POST">
          <div class="mb-3">
            <label for="json_file" class="form-label">Ø§Ø®ØªØ± Ù…Ù„Ù JSON:</label>
            <select
              class="form-select"
              id="json_file"
              name="json_file"
              required
            >
              {% for file in available_files %}
              <option value="{{ file }}">{{ file }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="num_participants" class="form-label"
              >Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†:</label
            >
            <input
              type="number"
              class="form-control"
              id="num_participants"
              name="num_participants"
              required
            />
            <label for="num_videos">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„ÙƒÙ„ Ù…Ø¨Ø§Ø±Ø§Ø©:</label>
            <input
              type="number"
              id="num_videos"
              name="num_videos"
              min="2"
              value="2"
            />
            <br />
            <label for="ranking_type">Ù†ÙˆØ¹ Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
            <select id="ranking_type" name="ranking_type">
              <option value="winner_only">Winner Only</option>
              <option value="ranked_type">Ranked Type</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">
            Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          </button>
        </form>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <h3>Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©</h3>
        <form
          id="continueTournamentForm"
          action="{{ url_for('tour_continue') }}"
          method="POST"
        >
          <div class="mb-3">
            <label for="tournament_file" class="form-label"
              >Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label
            >
            <select
              class="form-select"
              id="tournament_file"
              name="tournament_file"
              required
            >
              {% for file in tournament_files %}
              <option value="{{ file }}">{{ file }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">
            Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="mt-5">
    <h2 class="text-center">
      {% if current_view == 'videos' %}
        Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©
      {% else %}
        Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
      {% endif %}
    </h2>
    
    {% if current_view == 'videos' %}
      <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© -->
      {% if video_weights %}
      <div class="video-container" id="videoContainer">
        {% for video_name, weight in video_weights %}
        <div class="video-card">
          <div class="ranking">{{ video_name }}</div>
          <div class="ranking">Ø§Ù„ÙˆØ²Ù†: {{ "%.2f"|format(weight) }}</div>
          <div class="ranking">Ø§Ù„ØªÙƒØ±Ø§Ø±: {{ video_counts[video_name] }}</div>
          <div class="preview">
            {% if video_name is string and (video_name.lower().endswith('.jpg') or video_name.lower().endswith('.jpeg') or video_name.lower().endswith('.png') or video_name.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=video_name) }}" class="small-image" alt="{{ video_name }}">
            {% else %}
                <div class="loading-placeholder" data-video-src="{{ url_for('serve_video', filename=video_name) }}">
                    <i class="fas fa-video fa-2x"></i>
                </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…ØªØ§Ø­Ø©.</p>
      {% endif %}
      
    {% else %}
      <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ) -->
      {% if tournament_archive %}
      <div class="video-container" id="videoContainer">
        {% for tournament_id, tournament_data in tournament_archive %}
        <div class="w-100 text-center tournament-name">
          {{ tournament_id }} (ÙˆØ²Ù†: {{ "%.2f"|format(get_tournament_weight(tournament_id)) if get_tournament_weight else 0 }})
          
          <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ© -->
          <form action="{{ url_for('delete_tournament', tournament_id=tournament_id) }}" method="POST" style="display:inline;" onsubmit="return handleRename('{{ tournament_id }}', this)">
              <input type="hidden" name="action" value="rename">
              <input type="hidden" name="new_name" value="">
              <button type="submit" class="btn btn-custom-rename">
                  <i class="fas fa-edit"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©
              </button>
          </form>
          
          <!-- Ø²Ø± Ø§Ù„Ø­Ø°Ù -->
          <form action="{{ url_for('delete_tournament', tournament_id=tournament_id) }}" method="POST" style="display:inline;" onsubmit="return confirmDelete('{{ tournament_id }}')">
              <input type="hidden" name="action" value="delete">
              <button type="submit" class="btn btn-custom-delete">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
          </form>
        </div>

        {% if tournament_data.get('top1') %}
        <div class="video-card">
          <div class="ranking">TOP 1 ğŸ†</div>
          <div class="preview">
            {% if tournament_data['top1']['video'] %}
              {% set filename = tournament_data['top1']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 1">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 1</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top2') %}
        <div class="video-card">
          <div class="ranking">TOP 2 ğŸ¥ˆ</div>
          <div class="preview">
            {% if tournament_data['top2']['video'] %}
              {% set filename = tournament_data['top2']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 2">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 2</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top3') %}
        <div class="video-card">
          <div class="ranking">TOP 3 ğŸ¥‰</div>
          <div class="preview">
            {% if tournament_data['top3']['video'] %}
              {% set filename = tournament_data['top3']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 3">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 3</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top4') %}
        <div class="video-card">
          <div class="ranking">TOP 4</div>
          <div class="preview">
            {% if tournament_data['top4']['video'] %}
              {% set filename = tournament_data['top4']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 4">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 4</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        {% endfor %}
      </div>
      {% else %}
      <p class="text-center text-muted">
        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ø´ÙŠÙ Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.
      </p>
      {% endif %}
    {% endif %}
  </div>
</div>

<script>
  document
    .getElementById("continueTournamentForm")
    .addEventListener("submit", function () {
      let tournamentFile = document.getElementById("tournament_file").value;
      localStorage.setItem("selected_folder", tournamentFile);
    });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let selectedFolder =
      localStorage.getItem("selected_folder") ||
      "{{ selected_folder|default('') }}";
    if (selectedFolder) {
      console.log("ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ù„Ù Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©: " + selectedFolder);
      localStorage.removeItem("selected_folder");
      setTimeout(function () {
        fetch("/get_tournament_content/" + selectedFolder)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©");
            }
            return response.json();
          })
          .then((data) => {
            console.log("ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©:", data);
            let form = document.createElement("form");
            form.method = "POST";
            form.action = "/competition";

            let input = document.createElement("input");
            input.type = "hidden";
            input.name = "json_data";
            input.value = JSON.stringify(data);
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
          })
          .catch((error) => {
            console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©:", error);
          });
      }, 500);
    }
  });
</script>

<script>
  // 1. Ù†ÙØµÙ„ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø¯Ø§Ù„Ø© Ù„ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¦Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
  function startLoading(placeholders) {
    let idx = 0;
    const batchSize = 4; // Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­Ù…ÙŠÙ„Ù‡Ø§ ÙÙŠ ÙƒÙ„ Ø¯ÙØ¹Ø©

    function loadNextBatch() {
      let cnt = 0; // Ø¹Ø¯Ø§Ø¯ Ù„Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

      while (
        cnt < batchSize &&
        idx < placeholders.length
      ) {
        const ph = placeholders[idx];
        const videoSrc = ph.dataset.videoSrc;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± <video> ÙƒÙ…Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        const video = document.createElement("video");
        video.className = "small-video";
        video.controls = true;
        video.muted = true; // ÙŠØ¨Ø¯Ø£ ÙƒØªÙ… Ø§Ù„ØµÙˆØª
        video.autoplay = false; // Ù„Ø§ ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        video.playsInline = true; // Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù† Ø¹Ù„Ù‰ iOS Safari
        video.preload = "metadata"; // ÙŠØ­Ù…Ù„ ÙÙ‚Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ø«Ø§Ù†ÙŠØ© Ø«Ù… Ø¥ÙŠÙ‚Ø§ÙÙ‡
        video.onloadeddata = function () {
          this.play();
          setTimeout(() => this.pause(), 1000);
        };

        const source = document.createElement("source");
        source.src = videoSrc;
        source.type = "video/mp4";
        video.appendChild(source);

        ph.replaceWith(video); // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø§Ø¦Ø¨ Ø¨Ø§Ù„ÙÙŠØ¯ÙŠÙˆ

        idx++;
        cnt++;
      }

      // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙ‚Ø· Ø¥Ù† ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„
      if (idx < placeholders.length) {
        setTimeout(loadNextBatch, 1000); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
      }
    }

    loadNextBatch(); // Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
  }

  document.addEventListener("DOMContentLoaded", function () {
    // 2. Ù†Ø´ØºÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© (tournament-name)
    document.querySelectorAll(".tournament-name").forEach(function (nameEl) {
      // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ù‚Ø¯ ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªÙ‡Ø§ Ø¨Ø§Ù„ÙØ¹Ù„
      let loaded = false; 
      
      nameEl.addEventListener("click", function (event) { // Ø¥Ø¶Ø§ÙØ© event ÙƒØ¨Ø§Ø±Ø§Ù…ÙŠØªØ±
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†Ù‚Ø± Ù„ÙŠØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ tournament-name
        if (event.target.closest('form')) {
          return;
        }

        if (loaded) { // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù‚Ø¯ Ø­Ù…Ù„Øª Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹
          return;
        }

        // Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù€ placeholders Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©
        const placeholders = [];
        let el = nameEl.nextElementSibling; // Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù€ tournament-name

        // Ù†Ù…Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø­ØªÙ‰ Ù†ØµÙ„ Ø¥Ù„Ù‰ Ø§Ø³Ù… Ø¨Ø·ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        while (el && !el.classList.contains("tournament-name")) {
          // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ .loading-placeholder Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ .video-card
          const ph = el.querySelector(".loading-placeholder");
          if (ph) {
            placeholders.push(ph);
          }
          el = el.nextElementSibling;
        }

        // 3. Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ù†Ù‚Ø±Ø©
        if (placeholders.length) {
          startLoading(placeholders);
          loaded = true; // Ù†Ø¹ÙŠÙ† Ø¥Ù„Ù‰ true Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©
        }
      });
    });

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙØ±Ø¯ÙŠØ©)
    const currentView = document.getElementById('view_type') ? document.getElementById('view_type').value : null;
    if (currentView === 'videos') {
        const videoPlaceholders = document.querySelectorAll('#videoContainer .loading-placeholder');
        if (videoPlaceholders.length) {
            startLoading(Array.from(videoPlaceholders));
        }
    }
  });
</script>

<script>
  // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ©
  function handleRename(tournamentId, form) {
      const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø·ÙˆÙ„Ø©:", tournamentId);
      if (newName && newName.trim() !== "" && newName !== tournamentId) {
          form.querySelector('input[name="new_name"]').value = newName.trim();
          return true; // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯
      }
      return false; // Ø¥Ù„ØºØ§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  }

  // Ø¯Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
  function confirmDelete(tournamentId) {
      return confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© " + tournamentId + "ØŸ");
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª JSON Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
    const jsonSelect = document.getElementById("json_file");
    if (jsonSelect) {
      const optionsArray = Array.from(jsonSelect.options);
      // Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø­ÙŠØ« ÙŠØµØ¨Ø­ Ø£Ø­Ø¯Ø« Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹
      optionsArray.reverse();
      jsonSelect.innerHTML = "";
      optionsArray.forEach((option) => {
        jsonSelect.add(option);
      });
      // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± Ø³Ø§Ø¨Ù‚Ù‹Ø§ Ù…Ù† localStorage Ø¥Ù† ÙˆÙØ¬Ø¯
      const storedJsonFile = localStorage.getItem("selected_json_file");
      if (storedJsonFile) {
        jsonSelect.value = storedJsonFile;
      }
      // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ localStorage
      jsonSelect.addEventListener("change", function () {
        localStorage.setItem("selected_json_file", jsonSelect.value);
      });
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª JSON Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
    const tournamentSelect = document.getElementById("tournament_file");
    if (tournamentSelect) {
      const optionsArray = Array.from(tournamentSelect.options);
      // Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø­ÙŠØ« ÙŠØµØ¨Ø­ Ø£Ø­Ø¯Ø« Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹
      optionsArray.reverse();
      tournamentSelect.innerHTML = "";
      optionsArray.forEach((option) => {
        tournamentSelect.add(option);
      });
      // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± Ø³Ø§Ø¨Ù‚Ù‹Ø§ Ù…Ù† localStorage Ø¥Ù† ÙˆÙØ¬Ø¯
      const storedTournamentFile = localStorage.getItem(
        "selected_tournament_file",
      );
      if (storedTournamentFile) {
        tournamentSelect.value = storedTournamentFile;
      }
      // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ localStorage
      tournamentSelect.addEventListener("change", function () {
        localStorage.setItem(
          "selected_tournament_file",
          tournamentSelect.value,
        );
      });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
