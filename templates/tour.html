<!-- START OF FILE templates/tour.html -->

<!doctype html>
<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

<style>
  body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  .container {
    max-width: 900px;
  }

  h1,
  h2,
  h3 {
    color: #f8f9fa;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .card {
    background-color: #292929;
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: transform 0.2s ease-in-out;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .form-label {
    color: #ced4da;
    font-weight: 500;
  }

  .form-control,
  .form-select {
    background-color: #333;
    color: #fff;
    border: 1px solid #444;
  }

  .form-control:focus,
  .form-select:focus {
    background-color: #444;
    color: #fff;
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  .btn-success,
  .btn-primary,
  .btn-secondary {
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }

  .btn-secondary:hover {
    filter: brightness(1.2);
  }

  .alert {
    border-radius: 8px;
  }

  .file-preview {
    max-width: 200px;
    max-height: 200px;
    border: 1px solid #555;
    margin-right: 10px;
    border-radius: 8px;
  }

  table td {
    vertical-align: middle;
  }

  .preview {
    display: inline-block;
    margin: 5px;
    text-align: center;
  }

  .video-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    padding: 1rem 0;
  }

  .video-card {
    background: #1f1f1f;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    width: 200px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out;
    border: 1px solid #333;
  }

  .video-card:hover {
    transform: scale(1.05);
  }

  .video-card .ranking {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #ddd;
    font-family: "Helvetica Neue", Arial, sans-serif;
  }

  .small-video {
    width: 180px;
    height: auto;
    border-radius: 8px;
  }
  
  .small-image {
    width: 180px;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
  }

  .loading-placeholder {
    background: #333;
    width: 180px;
    height: 180px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
  }

  .btn-success::before {
    font-family: "Font Awesome 6 Free";
    content: "\f067";
    margin-right: 0.5rem;
    font-weight: 900;
  }

  .btn-primary::before {
    font-family: "Font Awesome 6 Free";
    content: "\f044";
    margin-right: 0.5rem;
    font-weight: 900;
  }

  .btn-secondary::before {
    font-family: "Font Awesome 6 Free";
    content: "\f015";
    margin-right: 0.5rem;
    font-weight: 900;
  }
  
  .btn-custom-rename,
  .btn-custom-delete {
    padding: 0.25rem 0.6rem;
    font-size: 0.8rem;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
    display: inline-flex;
    align-items: center;
    white-space: nowrap;
    margin-right: 5px;
  }

  .btn-custom-rename {
    background-color: #4a4a4a;
    border-color: #555;
    color: #e0e0e0;
  }

  .btn-custom-rename:hover {
    background-color: #5a5a5a;
    border-color: #666;
    color: #fff;
  }

  .btn-custom-delete {
    background-color: #8b0000;
    border-color: #a00000;
    color: #e0e0e0;
  }

  .btn-custom-delete:hover {
    background-color: #a00000;
    border-color: #b00000;
    color: #fff;
  }

  .btn-custom-rename .fas,
  .btn-custom-delete .fas {
    margin-right: 0.3rem;
    font-size: 0.7rem;
  }

  .tournament-name {
    font-size: 1.2rem;
    color: #bbb;
    font-weight: 600;
    font-family: "Roboto", sans-serif;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    flex-wrap: wrap; 
  }
  .tournament-name form {
      margin-left: 10px;
      margin-top: 5px;
      white-space: nowrap; 
  }

  .home-button-container {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
  }
</style>
  </head>

  <body class="dark-mode">
    <div class="home-button-container">
      <a href="{{ url_for('index') }}" class="btn btn-secondary"
        >Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a
      >
    </div>
    <div class="container mt-5">
      <h1 class="text-center mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h1>

      <!-- Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¹Ø±Ø¶ -->
      <div class="card mb-4">
        <div class="card-body">
          <h5>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨</h5>
          <form method="POST">
            <div class="row">
              <div class="col-md-6">
                <label for="view_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶:</label>
                <select class="form-select" name="view_type" id="view_type">
                  <option value="tournaments" {% if current_view == 'tournaments' %}selected{% endif %}>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</option>
                  <option value="videos" {% if current_view == 'videos' %}selected{% endif %}>Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="sort_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªØ±ØªÙŠØ¨:</label>
                <select class="form-select" name="sort_type" id="sort_type">
                  <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                  <option value="asc_weight" {% if current_sort == 'asc_weight' %}selected{% endif %}>ØªØµØ§Ø¹Ø¯ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†</option>
                  <option value="desc_weight" {% if current_sort == 'desc_weight' %}selected{% endif %}>ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†</option>
                  <option value="most_frequent" {% if current_sort == 'most_frequent' %}selected{% endif %}>Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn btn-primary mt-2">ØªØ·Ø¨ÙŠÙ‚</button>
          </form>
        </div>
      </div>
      <!-- Ù†Ù‡Ø§ÙŠØ© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¹Ø±Ø¶ -->

{% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <div class="mb-4">
    {% for category, message in messages %}
    <div
      class="alert alert-{{ category }} alert-dismissible fade show"
      role="alert"
    >
      {{ message }}
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="alert"
      ></button>
    </div>
    {% endfor %}
  </div>
  {% endif %} {% endwith %}

  <div class="row">
    <!-- START: MODIFIED SECTION - New Tournament Form -->
    <div class="col-md-6">
      <div class="card">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <form action="{{ url_for('tour_create') }}" method="POST">
          <div class="mb-3">
            <label for="json_file" class="form-label">Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø± (Base):</label>
            <select class="form-select" id="json_file" name="json_file" required>
              {% for file in available_files %}
              <option value="{{ file }}">{{ file }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="row mb-3">
              <div class="col-md-6">
                <label for="num_participants" class="form-label small">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† (Ù„Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ):</label>
                <input type="number" class="form-control" id="num_participants" name="num_participants" placeholder="Ù…Ø«Ù„Ø§Ù‹ 32">
              </div>
              <div class="col-md-6">
                <label for="num_matches_total" class="form-label small">Ø£Ùˆ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</label>
                <input type="number" class="form-control" id="num_matches_total" name="num_matches_total" placeholder="Ù…Ø«Ù„Ø§Ù‹ 16">
              </div>
          </div>

          <div class="mb-3">
            <div class="row">
                <div class="col-6">
                    <label for="num_videos" class="form-label small">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„ÙƒÙ„ Ù…Ø¨Ø§Ø±Ø§Ø©:</label>
                    <input type="number" id="num_videos" name="num_videos" class="form-control" min="2" value="2">
                </div>
                <div class="col-6">
                    <label for="ranking_type" class="form-label small">Ù†ÙˆØ¹ Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <select id="ranking_type" name="ranking_type" class="form-select">
                      <option value="winner_only">Winner Only</option>
                      <option value="ranked_type">Ranked Type</option>
                    </select>
                </div>
            </div>
          </div>

          <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‡Ù†Ø© -->
          <div class="card bg-dark border-warning mb-3">
              <div class="card-header border-warning text-warning p-2">
                  <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="include_bets" name="include_bets" onchange="toggleBetOptions()">
                      <label class="form-check-label fw-bold" for="include_bets">
                          <i class="fas fa-crosshairs"></i> ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª
                      </label>
                  </div>
              </div>
              <div class="card-body p-2" id="bet_options" style="display: none;">
                  <div class="mb-2">
                      <label class="form-label small">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª Ù„Ø¥Ø¯Ø±Ø§Ø¬Ù‡Ø§:</label>
                      <input type="number" name="bet_count" class="form-control bg-secondary text-white form-control-sm" min="1" value="1">
                  </div>
                  
                  <div class="mb-2">
                      <label class="form-label small">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±:</label>
                      <div class="btn-group w-100 btn-group-sm" role="group">
                          <input type="radio" class="btn-check" name="bet_mode" id="bet_mode_random" value="random" checked onchange="toggleBetList()">
                          <label class="btn btn-outline-warning" for="bet_mode_random">Ø¹Ø´ÙˆØ§Ø¦ÙŠ</label>

                          <input type="radio" class="btn-check" name="bet_mode" id="bet_mode_manual" value="manual" onchange="toggleBetList()">
                          <label class="btn btn-outline-warning" for="bet_mode_manual">ÙŠØ¯ÙˆÙŠ</label>
                      </div>
                  </div>

                  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ© Ù…Ø¹ Ø®ÙŠØ§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ -->
                  <div id="manual_bet_list" style="display: none; max-height: 150px; overflow-y: auto; background: #222; padding: 5px; border-radius: 4px;">
                      <label class="form-label text-muted small mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª:</label>
                      {% if active_bets %}
                          <!-- Ø®ÙŠØ§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ -->
                          <div class="form-check border-bottom border-secondary mb-2 pb-1">
                              <input class="form-check-input" type="checkbox" id="check_all_bets" onchange="toggleAllBets(this)">
                              <label class="form-check-label small text-warning fw-bold" for="check_all_bets">
                                  ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                              </label>
                          </div>

                          {% for bet in active_bets %}
                          <div class="form-check">
                              <!-- ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ bet-checkbox Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ -->
                              <input class="form-check-input bet-checkbox" type="checkbox" name="selected_bets" value="{{ bet.challenger }}" id="bet_check_{{ loop.index }}">
                              <label class="form-check-label small text-light" for="bet_check_{{ loop.index }}" style="font-size: 0.8em;">
                                  {{ bet.challenger }} <span class="text-warning">VS</span> {{ bet.defender }} ({{ bet.target }})
                              </label>
                          </div>
                          {% endfor %}
                      {% else %}
                          <p class="text-danger small mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ù‡Ø§Ù†Ø§Øª Ù†Ø´Ø·Ø©.</p>
                      {% endif %}
                  </div>
              </div>
          </div>

          <button type="submit" class="btn btn-success w-100">
            <i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          </button>
        </form>
      </div>
    </div>
    <!-- END: MODIFIED SECTION -->

    <div class="col-md-6">
      <div class="card">
        <h3>Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©</h3>
        <form
          id="continueTournamentForm"
          action="{{ url_for('tour_continue') }}"
          method="POST"
        >
          <div class="mb-3">
            <label for="tournament_file" class="form-label"
              >Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label
            >
            <select
              class="form-select"
              id="tournament_file"
              name="tournament_file"
              required
            >
              {% for file in tournament_files %}
              <option value="{{ file }}">{{ file }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">
            Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="mt-5">
    <h2 class="text-center">
      {% if current_view == 'videos' %}
        Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©
      {% else %}
        Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
      {% endif %}
    </h2>
    
    {% if current_view == 'videos' %}
      <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© -->
      {% if video_weights %}
      <div class="video-container" id="videoContainer">
        {% for video_name, weight in video_weights %}
        <div class="video-card">
          <div class="ranking">{{ video_name }}</div>
          <div class="ranking">Ø§Ù„ÙˆØ²Ù†: {{ "%.2f"|format(weight) }}</div>
          <div class="ranking">Ø§Ù„ØªÙƒØ±Ø§Ø±: {{ video_counts[video_name] }}</div>
          <div class="preview">
            {% if video_name is string and (video_name.lower().endswith('.jpg') or video_name.lower().endswith('.jpeg') or video_name.lower().endswith('.png') or video_name.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=video_name) }}" class="small-image" alt="{{ video_name }}">
            {% else %}
                <div class="loading-placeholder" data-video-src="{{ url_for('serve_video', filename=video_name) }}">
                    <i class="fas fa-video fa-2x"></i>
                </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…ØªØ§Ø­Ø©.</p>
      {% endif %}
      
    {% else %}
      <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ) -->
      {% if tournament_archive %}
      <div class="video-container" id="videoContainer">
        {% for tournament_id, tournament_data in tournament_archive %}
        <div class="w-100 text-center tournament-name">
          {{ tournament_id }} (ÙˆØ²Ù†: {{ "%.2f"|format(get_tournament_weight(tournament_id)) if get_tournament_weight else 0 }})
          
          <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ© -->
          <form action="{{ url_for('delete_tournament', tournament_id=tournament_id) }}" method="POST" style="display:inline;" onsubmit="return handleRename('{{ tournament_id }}', this)">
              <input type="hidden" name="action" value="rename">
              <input type="hidden" name="new_name" value="">
              <button type="submit" class="btn btn-custom-rename">
                  <i class="fas fa-edit"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©
              </button>
          </form>
          
          <!-- Ø²Ø± Ø§Ù„Ø­Ø°Ù -->
          <form action="{{ url_for('delete_tournament', tournament_id=tournament_id) }}" method="POST" style="display:inline;" onsubmit="return confirmDelete('{{ tournament_id }}')">
              <input type="hidden" name="action" value="delete">
              <button type="submit" class="btn btn-custom-delete">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
          </form>
        </div>

        {% if tournament_data.get('top1') %}
        <div class="video-card">
          <div class="ranking">TOP 1 ğŸ†</div>
          <div class="preview">
            {% if tournament_data['top1']['video'] %}
              {% set filename = tournament_data['top1']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 1">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 1</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top2') %}
        <div class="video-card">
          <div class="ranking">TOP 2 ğŸ¥ˆ</div>
          <div class="preview">
            {% if tournament_data['top2']['video'] %}
              {% set filename = tournament_data['top2']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 2">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 2</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top3') %}
        <div class="video-card">
          <div class="ranking">TOP 3 ğŸ¥‰</div>
          <div class="preview">
            {% if tournament_data['top3']['video'] %}
              {% set filename = tournament_data['top3']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 3">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 3</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        
        {% if tournament_data.get('top4') %}
        <div class="video-card">
          <div class="ranking">TOP 4</div>
          <div class="preview">
            {% if tournament_data['top4']['video'] %}
              {% set filename = tournament_data['top4']['video'] %}
              {% if filename is string and (filename.lower().endswith('.jpg') or filename.lower().endswith('.jpeg') or filename.lower().endswith('.png') or filename.lower().endswith('.gif')) %}
                <img src="{{ url_for('serve_video', filename=filename) }}" class="small-image" alt="TOP 4">
              {% else %}
                <div
                  class="loading-placeholder"
                  data-video-src="{{ url_for('serve_video', filename=filename) }}"
                >
                  <i class="fas fa-video fa-2x"></i>
                </div>
              {% endif %}
            {% else %}
              <p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ TOP 4</p>
            {% endif %}
          </div>
        </div>
        {% endif %} 
        {% endfor %}
      </div>
      {% else %}
      <p class="text-center text-muted">
        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ø´ÙŠÙ Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.
      </p>
      {% endif %}
    {% endif %}
  </div>
</div>

<script>
  document
    .getElementById("continueTournamentForm")
    .addEventListener("submit", function () {
      let tournamentFile = document.getElementById("tournament_file").value;
      localStorage.setItem("selected_folder", tournamentFile);
    });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let selectedFolder =
      localStorage.getItem("selected_folder") ||
      "{{ selected_folder|default('') }}";
    if (selectedFolder) {
      console.log("ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ù„Ù Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©: " + selectedFolder);
      localStorage.removeItem("selected_folder");
      setTimeout(function () {
        fetch("/get_tournament_content/" + selectedFolder)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©");
            }
            return response.json();
          })
          .then((data) => {
            console.log("ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©:", data);
            let form = document.createElement("form");
            form.method = "POST";
            form.action = "/competition";

            let input = document.createElement("input");
            input.type = "hidden";
            input.name = "json_data";
            input.value = JSON.stringify(data);
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
          })
          .catch((error) => {
            console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©:", error);
          });
      }, 500);
    }
  });
</script>

<script>
  function startLoading(placeholders) {
    let idx = 0;
    const batchSize = 4;

    function loadNextBatch() {
      let cnt = 0;

      while (
        cnt < batchSize &&
        idx < placeholders.length
      ) {
        const ph = placeholders[idx];
        const videoSrc = ph.dataset.videoSrc;

        const video = document.createElement("video");
        video.className = "small-video";
        video.controls = true;
        video.muted = true;
        video.autoplay = false;
        video.playsInline = true;
        video.preload = "metadata";

        video.onloadeddata = function () {
          this.play();
          setTimeout(() => this.pause(), 1000);
        };

        const source = document.createElement("source");
        source.src = videoSrc;
        source.type = "video/mp4";
        video.appendChild(source);

        ph.replaceWith(video);

        idx++;
        cnt++;
      }

      if (idx < placeholders.length) {
        setTimeout(loadNextBatch, 1000);
      }
    }

    loadNextBatch();
  }

  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".tournament-name").forEach(function (nameEl) {
      let loaded = false; 
      
      nameEl.addEventListener("click", function (event) {
        if (event.target.closest('form')) {
          return;
        }

        if (loaded) {
          return;
        }

        const placeholders = [];
        let el = nameEl.nextElementSibling;

        while (el && !el.classList.contains("tournament-name")) {
          const ph = el.querySelector(".loading-placeholder");
          if (ph) {
            placeholders.push(ph);
          }
          el = el.nextElementSibling;
        }

        if (placeholders.length) {
          startLoading(placeholders);
          loaded = true;
        }
      });
    });

    const currentView = document.getElementById('view_type') ? document.getElementById('view_type').value : null;
    if (currentView === 'videos') {
        const videoPlaceholders = document.querySelectorAll('#videoContainer .loading-placeholder');
        if (videoPlaceholders.length) {
            startLoading(Array.from(videoPlaceholders));
        }
    }
  });
</script>

<script>
  function handleRename(tournamentId, form) {
      const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø·ÙˆÙ„Ø©:", tournamentId);
      if (newName && newName.trim() !== "" && newName !== tournamentId) {
          form.querySelector('input[name="new_name"]').value = newName.trim();
          return true;
      }
      return false;
  }

  function confirmDelete(tournamentId) {
      return confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© " + tournamentId + "ØŸ");
  }

  document.addEventListener("DOMContentLoaded", function () {
    const jsonSelect = document.getElementById("json_file");
    if (jsonSelect) {
      const optionsArray = Array.from(jsonSelect.options);
      optionsArray.reverse();
      jsonSelect.innerHTML = "";
      optionsArray.forEach((option) => {
        jsonSelect.add(option);
      });
      const storedJsonFile = localStorage.getItem("selected_json_file");
      if (storedJsonFile) {
        jsonSelect.value = storedJsonFile;
      }
      jsonSelect.addEventListener("change", function () {
        localStorage.setItem("selected_json_file", jsonSelect.value);
      });
    }

    const tournamentSelect = document.getElementById("tournament_file");
    if (tournamentSelect) {
      const optionsArray = Array.from(tournamentSelect.options);
      optionsArray.reverse();
      tournamentSelect.innerHTML = "";
      optionsArray.forEach((option) => {
        tournamentSelect.add(option);
      });
      const storedTournamentFile = localStorage.getItem(
        "selected_tournament_file",
      );
      if (storedTournamentFile) {
        tournamentSelect.value = storedTournamentFile;
      }
      tournamentSelect.addEventListener("change", function () {
        localStorage.setItem(
          "selected_tournament_file",
          tournamentSelect.value,
        );
      });
    }
  });

  // START: MODIFIED SECTION - Bet Options Toggle Scripts
  function toggleBetOptions() {
      const isChecked = document.getElementById('include_bets').checked;
      document.getElementById('bet_options').style.display = isChecked ? 'block' : 'none';
  }

  function toggleBetList() {
      const isManual = document.getElementById('bet_mode_manual').checked;
      document.getElementById('manual_bet_list').style.display = isManual ? 'block' : 'none';
  }

  // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
  function toggleAllBets(source) {
      const checkboxes = document.querySelectorAll('.bet-checkbox');
      for(let i=0; i < checkboxes.length; i++) {
          checkboxes[i].checked = source.checked;
      }
  }
  // END: MODIFIED SECTION
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>