
{% extends "base.html" %}

{% block title %}{{ folder_name }} - متصفح الصور{% endblock %}

{% block top_controls %}
    {% if images %}
    <div class="page-info">
        <p>عرض {{ images|length }} صورة في هذه الصفحة (الإجمالي: {{ total_images }} صورة)</p>
        
        <!-- شريط التحكم (فرز + عدد الصور) -->
        <div class="controls-bar">
            <form method="get" action="{{ url_for('view_folder', folder_name=folder_name) }}" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
                
                <!-- خيار الفرز -->
                <div class="control-group">
                    <label for="sort_by">ترتيب حسب:</label>
                    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>الأحدث أولاً</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>الأقدم أولاً</option>
                        <option value="alpha_asc" {% if sort_by == 'alpha_asc' %}selected{% endif %}>أبجدياً (A-Z)</option>
                        <option value="alpha_desc" {% if sort_by == 'alpha_desc' %}selected{% endif %}>أبجدياً (Z-A)</option>
                        <option value="random" {% if sort_by == 'random' %}selected{% endif %}>عشوائي (Shuffle)</option>
                    </select>
                </div>

                <!-- عدد الصور -->
                <div class="control-group">
                    <label for="per_page">الصور في الصفحة:</label>
                    <select name="per_page" id="per_page" onchange="this.form.submit()">
                        {% for num in [25, 50, 75, 100, 150, 200] %}
                        <option value="{{ num }}" {% if num == per_page %}selected{% endif %}>{{ num }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
<a href="/" class="back-button">← العودة للصفحة الرئيسية</a>

<div class="section">
    <div class="section-header">
        <h2 class="section-title">{{ folder_name }}</h2>
    </div>

    {% if images %}
        <div class="images-grid">
            {% for image in images %}
            <div class="image-card" 
                 data-image-path="{{ image.relative_path }}"
                 data-image-name="{{ image.name | e }}"
                 data-model-name="{{ image.model_name | default('غير معروف') | e }}"
                 data-prompt-data="{{ image.prompt_data | e }}"
                 data-source-group="{{ image.source_group | default('') }}">
                
                <span class="favorite-star {% if image.is_favorite %}favorited{% endif %}" onclick="toggleFavorite(this, event)">★</span>
                <div class="image-content" onclick="toggleExifData(this)">
                    <img src="/image/{{ image.relative_path }}" alt="{{ image.name }}" loading="lazy">
                    <div class="image-info">
                        <div class="image-name">{{ image.name }}</div>
                        <div class="exif-data"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- أزرار الترقيم -->
        <div class="pagination-controls">
            {% if page > 1 %}
                <a href="{{ url_for('view_folder', folder_name=folder_name, page=page-1, per_page=per_page, sort_by=sort_by) }}">→ الصفحة السابقة</a>
            {% else %}
                <span class="disabled">→ الصفحة السابقة</span>
            {% endif %}

            <span class="current-page">صفحة {{ page }} من {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="{{ url_for('view_folder', folder_name=folder_name, page=page+1, per_page=per_page, sort_by=sort_by) }}">الصفحة التالية ←</a>
            {% else %}
                <span class="disabled">الصفحة التالية ←</span>
            {% endif %}
        </div>
    {% else %}
        <div class="no-images">لا توجد صور في هذا المجلد.</div>
    {% endif %}
</div>
{% endblock %}

--- START OF FILE search_results.html ---

{% extends "base.html" %}

{% block title %}نتائج البحث عن "{{ query }}"{% endblock %}

{% block top_controls %}
    {% if images %}
    <div class="page-info">
        <p>عرض {{ images|length }} صورة في هذه الصفحة (الإجمالي: {{ total_images }} نتيجة)</p>
        
        <!-- شريط التحكم (فرز + عدد الصور) -->
        <div class="controls-bar">
            <form method="get" action="{{ url_for('search') }}" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
                <!-- حقل خفي للحفاظ على كلمة البحث -->
                <input type="hidden" name="q" value="{{ query }}">

                <!-- خيار الفرز -->
                <div class="control-group">
                    <label for="sort_by">ترتيب النتائج:</label>
                    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>الأحدث أولاً</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>الأقدم أولاً</option>
                        <option value="alpha_asc" {% if sort_by == 'alpha_asc' %}selected{% endif %}>أبجدياً (A-Z)</option>
                        <option value="alpha_desc" {% if sort_by == 'alpha_desc' %}selected{% endif %}>أبجدياً (Z-A)</option>
                    </select>
                </div>

                <!-- عدد الصور -->
                <div class="control-group">
                    <label for="per_page">الصور في الصفحة:</label>
                    <select name="per_page" id="per_page" onchange="this.form.submit()">
                        {% for num in [25, 50, 75, 100, 150, 200] %}
                        <option value="{{ num }}" {% if num == per_page %}selected{% endif %}>{{ num }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
<a href="/" class="back-button">← العودة للصفحة الرئيسية</a>

<div class="section">
    <div class="section-header">
        <h2 class="section-title">نتائج البحث عن: "{{ query }}"</h2>
    </div>

    {% if images %}
        <div class="images-grid">
            {% for image in images %}
            <div class="image-card" 
                 data-image-path="{{ image.relative_path }}"
                 data-image-name="{{ image.name | e }}"
                 data-model-name="{{ image.model_name | default('غير معروف') | e }}"
                 data-prompt-data="{{ image.prompt_data | e }}"
                 data-source-group="{{ image.source_group | default('') }}">
                
                <span class="favorite-star {% if image.is_favorite %}favorited{% endif %}" onclick="toggleFavorite(this, event)">★</span>
                <div class="image-content" onclick="toggleExifData(this)">
                    <img src="/image/{{ image.relative_path }}" alt="{{ image.name }}" loading="lazy">
                    <div class="image-info">
                        <div class="image-name">{{ image.name }}</div>
                        <div class="exif-data"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- أزرار الترقيم -->
        <div class="pagination-controls">
            {% if page > 1 %}
                <a href="{{ url_for('search', q=query, page=page-1, per_page=per_page, sort_by=sort_by) }}">→ الصفحة السابقة</a>
            {% else %}
                <span class="disabled">→ الصفحة السابقة</span>
            {% endif %}

            <span class="current-page">صفحة {{ page }} من {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="{{ url_for('search', q=query, page=page+1, per_page=per_page, sort_by=sort_by) }}">الصفحة التالية ←</a>
            {% else %}
                <span class="disabled">الصفحة التالية ←</span>
            {% endif %}
        </div>
    {% else %}
        <div class="no-images">لم يتم العثور على نتائج للبحث عن "{{ query }}".</div>
    {% endif %}
</div>
{% endblock %}