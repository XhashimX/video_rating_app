<!-- START: MODIFIED SECTION -->
{% extends "base.html" %}

{% block title %}{{ folder_name }} - Ù…ØªØµÙØ­ Ø§Ù„ØµÙˆØ±{% endblock %}

{% block content %}
<a href="/" class="back-button">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<h1>Ù…Ø¬Ù„Ø¯: {{ folder_name }}</h1>

<!-- ØªØ¹Ø¯ÙŠÙ„: Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¢Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© -->
<div class="folder-controls" style="margin-bottom: 20px; text-align: center;">
    <button id="sort-alpha-btn" class="action-button">ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</button>
    <button id="sort-date-btn" class="action-button" style="display:none;">ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø«)</button>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…ÙŠØ²Ø© Ù…ÙØ¹Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ -->
    {% if show_classification %}
    <div id="classification-controls" style="display: inline-block; margin-right: 15px;">
        <button id="classify-by-model-btn" class="action-button">ØªØµÙ†ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</button>
        <button id="show-all-btn" class="action-button" style="display:none;">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØµÙˆØ±</button>
        <button id="back-to-models-btn" class="action-button" style="display:none;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</button>
    </div>
    {% endif %}
</div>

<div class="section">
    {% if images %}
        <div class="images-grid" id="images-grid-container">
            {% for image in images %}
            <!-- ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© data-model-name Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù… -->
            <div class="image-card" 
                 data-image-path="{{ image.relative_path }}"
                 data-image-name="{{ image.name | e }}"
                 data-model-name="{{ image.model_name | default('ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ') | e }}">

                <span class="favorite-star {% if image.is_favorite %}favorited{% endif %}" onclick="toggleFavorite(this, event)">â˜…</span>

                <div class="image-content" onclick="toggleExifData(this)">
                    <img src="/image/{{ image.relative_path }}" alt="{{ image.name }}" loading="lazy">
                    <div class="image-info">
                        <div class="image-name">{{ image.name }}</div>
                        <div class="exif-data"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <!-- Ø¥Ø¶Ø§ÙØ© Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª -->
        <div class="folders-grid" id="models-grid-container" style="display:none;"></div>
    {% else %}
        <div class="no-images">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§.</div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ÙØ±Ø² Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠ/Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ---
    const sortAlphaBtn = document.getElementById('sort-alpha-btn');
    const sortDateBtn = document.getElementById('sort-date-btn');
    const imagesGrid = document.getElementById('images-grid-container');
    if (imagesGrid) {
        const originalImageCards = Array.from(imagesGrid.querySelectorAll('.image-card'));
        sortAlphaBtn.addEventListener('click', () => {
            const imageCards = Array.from(imagesGrid.querySelectorAll('.image-card'));
            imageCards.sort((a, b) => a.dataset.imageName.localeCompare(b.dataset.imageName));
            imagesGrid.innerHTML = '';
            imageCards.forEach(card => imagesGrid.appendChild(card));
            sortAlphaBtn.style.display = 'none';
            sortDateBtn.style.display = 'inline-block';
        });
        sortDateBtn.addEventListener('click', () => {
            imagesGrid.innerHTML = '';
            originalImageCards.forEach(card => imagesGrid.appendChild(card));
            sortDateBtn.style.display = 'none';
            sortAlphaBtn.style.display = 'inline-block';
        });
    }

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙ†ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯Ø©) ---
    const classifyBtn = document.getElementById('classify-by-model-btn');
    if (classifyBtn) {
        const showAllBtn = document.getElementById('show-all-btn');
        const backToModelsBtn = document.getElementById('back-to-models-btn');
        const modelsGridContainer = document.getElementById('models-grid-container');
        const sectionTitle = document.querySelector('h1'); // Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const allImageCards = imagesGrid ? Array.from(imagesGrid.querySelectorAll('.image-card')) : [];
        const originalTitle = sectionTitle.textContent;

        function showAllImagesView() {
            sectionTitle.textContent = originalTitle;
            modelsGridContainer.style.display = 'none';
            if (imagesGrid) imagesGrid.style.display = 'grid';
            allImageCards.forEach(card => { card.style.display = 'block'; });
            showAllBtn.style.display = 'none';
            backToModelsBtn.style.display = 'none';
            classifyBtn.style.display = 'inline-block';
            sortAlphaBtn.style.display = 'inline-block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ÙØ±Ø²
        }

        function showModelsView() {
            const models = new Map();
            allImageCards.forEach(card => {
                const modelName = card.dataset.modelName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                models.set(modelName, (models.get(modelName) || 0) + 1);
            });
            const sortedModels = new Map([...models.entries()].sort((a, b) => a[0].localeCompare(b[0])));
            
            sectionTitle.textContent = 'Ø§Ù„ØªØµÙ†ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„';
            if (imagesGrid) imagesGrid.style.display = 'none';
            modelsGridContainer.innerHTML = '';
            
            sortedModels.forEach((count, modelName) => {
                const modelCard = document.createElement('div');
                modelCard.className = 'folder-card';
                modelCard.innerHTML = `<a>ğŸ¨ ${modelName} (${count})</a>`;
                modelCard.onclick = () => showImagesForModel(modelName);
                modelsGridContainer.appendChild(modelCard);
            });
            modelsGridContainer.style.display = 'grid';
            
            classifyBtn.style.display = 'none';
            showAllBtn.style.display = 'inline-block';
            backToModelsBtn.style.display = 'none';
            sortAlphaBtn.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ÙØ±Ø²
            sortDateBtn.style.display = 'none';
        }
        
        function showImagesForModel(modelName) {
            sectionTitle.textContent = `Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modelName}`;
            modelsGridContainer.style.display = 'none';
            if (imagesGrid) imagesGrid.style.display = 'grid';
            
            allImageCards.forEach(card => {
                card.style.display = (card.dataset.modelName === modelName) ? 'block' : 'none';
            });
            
            showAllBtn.style.display = 'inline-block';
            backToModelsBtn.style.display = 'inline-block';
            classifyBtn.style.display = 'none';
            sortAlphaBtn.style.display = 'inline-block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ÙØ±Ø²
        }

        classifyBtn.addEventListener('click', showModelsView);
        showAllBtn.addEventListener('click', showAllImagesView);
        backToModelsBtn.addEventListener('click', showModelsView); // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
    }
});
</script>
{% endblock %}
<!-- END: MODIFIED SECTION -->