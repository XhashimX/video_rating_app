
{% extends "base.html" %}

{% block title %}ูุชุตูุญ ุงูุตูุฑ - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ{% endblock %}

{% block top_controls %}
    {% if download_images %}
    <div class="page-info">
        <p>ุนุฑุถ {{ download_images|length }} ุตูุฑุฉ ูู ูุฐู ุงูุตูุญุฉ (ุงูุฅุฌูุงูู: {{ total_images }} ุตูุฑุฉ)</p>
        
        <!-- ุดุฑูุท ุงูุชุญูู (ูุฑุฒ + ุนุฏุฏ ุงูุตูุฑ) -->
        <div class="controls-bar">
            <form method="get" action="{{ url_for('index') }}" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
                
                <!-- ุฎูุงุฑ ุงููุฑุฒ -->
                <div class="control-group">
                    <label for="sort_by">ุชุฑุชูุจ ุญุณุจ:</label>
                    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>ุงูุฃุญุฏุซ ุฃููุงู</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>ุงูุฃูุฏู ุฃููุงู</option>
                        <option value="alpha_asc" {% if sort_by == 'alpha_asc' %}selected{% endif %}>ุฃุจุฌุฏูุงู (A-Z)</option>
                        <option value="alpha_desc" {% if sort_by == 'alpha_desc' %}selected{% endif %}>ุฃุจุฌุฏูุงู (Z-A)</option>
                        <option value="random" {% if sort_by == 'random' %}selected{% endif %}>ุนุดูุงุฆู (Shuffle)</option>
                    </select>
                </div>

                <!-- ุนุฏุฏ ุงูุตูุฑ -->
                <div class="control-group">
                    <label for="per_page">ุงูุตูุฑ ูู ุงูุตูุญุฉ:</label>
                    <select name="per_page" id="per_page" onchange="this.form.submit()">
                        {% for num in [25, 50, 75, 100, 150, 200] %}
                        <option value="{{ num }}" {% if num == per_page %}selected{% endif %}>{{ num }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
<!-- ูุณู ุงููุงุด ุงูุฑุฆูุณู -->
<div class="section">
    <div class="section-header">
        <h2 class="section-title">ุงููุงุด ุงูุฑุฆูุณู (Downloads + Dib + Extra)</h2>
    </div>

    {% if download_images %}
        <div class="images-grid">
            {% for image in download_images %}
            <div class="image-card" 
                 data-image-path="{{ image.relative_path }}"
                 data-image-name="{{ image.name | e }}"
                 data-model-name="{{ image.model_name | default('ุบูุฑ ูุนุฑูู') | e }}"
                 data-prompt-data="{{ image.prompt_data | e }}"
                 data-source-group="{{ image.source_group | default('') }}">
                
                <span class="favorite-star {% if image.is_favorite %}favorited{% endif %}" onclick="toggleFavorite(this, event)">โ</span>
                <div class="image-content" onclick="toggleExifData(this)">
                    <img src="/image/{{ image.relative_path }}" alt="{{ image.name }}" loading="lazy">
                    <div class="image-info">
                        <div class="image-name">{{ image.name }}</div>
                        <div class="exif-data"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ุฃุฒุฑุงุฑ ุงูุชููู ุจูู ุงูุตูุญุงุช (ูุน ุงูุญูุงุธ ุนูู ุงููุฑุฒ) -->
        <div class="pagination-controls">
            {% if page > 1 %}
                <a href="{{ url_for('index', page=page-1, per_page=per_page, sort_by=sort_by) }}">โ ุงูุตูุญุฉ ุงูุณุงุจูุฉ</a>
            {% else %}
                <span class="disabled">โ ุงูุตูุญุฉ ุงูุณุงุจูุฉ</span>
            {% endif %}

            <span class="current-page">ุตูุญุฉ {{ page }} ูู {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="{{ url_for('index', page=page+1, per_page=per_page, sort_by=sort_by) }}">ุงูุตูุญุฉ ุงูุชุงููุฉ โ</a>
            {% else %}
                <span class="disabled">ุงูุตูุญุฉ ุงูุชุงููุฉ โ</span>
            {% endif %}
        </div>

    {% else %}
        <div class="no-images">ูุง ุชูุฌุฏ ุตูุฑ. ูู ุจุชุดุบูู `scan.py` ุฃููุงู.</div>
    {% endif %}
</div>

<!-- ูุณู ุงููุฌูุฏุงุช ุงูุฃุฎุฑู (TikTok) -->
<div class="section">
    <h2>ุงููุฌูุฏุงุช ุงูุฃุฎุฑู</h2>
    {% if tiktok_folders %}
        <div class="folders-grid">
            {% for folder in tiktok_folders %}
            <div class="folder-card">
                <a href="/folder/{{ folder.name }}">๐ {{ folder.name }}</a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-images">ูุง ุชูุฌุฏ ูุฌูุฏุงุช</div>
    {% endif %}
</div>
{% endblock %}
