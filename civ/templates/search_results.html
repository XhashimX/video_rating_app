{% extends "base.html" %}

{% block title %}نتائج البحث عن "{{ query }}"{% endblock %}

{% block top_controls %}
    {% if images %}
    <div class="page-info">
        <p>عرض {{ images|length }} صورة في هذه الصفحة (الإجمالي: {{ total_images }} نتيجة)</p>
        <div class="pagination-controls">
            <div class="per-page-selector">
                <form method="get" action="{{ url_for('search') }}">
                    <!-- حقل خفي للحفاظ على كلمة البحث عند تغيير عدد الصور -->
                    <input type="hidden" name="q" value="{{ query }}">
                    <label for="per_page">الصور في الصفحة:</label>
                    <select name="per_page" id="per_page" onchange="this.form.submit()">
                        {% for num in [25, 50, 75, 100, 150, 200] %}
                        <option value="{{ num }}" {% if num == per_page %}selected{% endif %}>{{ num }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block content %}
<a href="/" class="back-button">← العودة للصفحة الرئيسية</a>

<div class="section">
    <div class="section-header">
        <h2 class="section-title">نتائج البحث عن: "{{ query }}"</h2>
    </div>

    {% if images %}
        <div class="images-grid">
            {% for image in images %}
            <div class="image-card" 
                 data-image-path="{{ image.relative_path }}"
                 data-image-name="{{ image.name | e }}"
                 data-model-name="{{ image.model_name | default('غير معروف') | e }}"
                 data-prompt-data="{{ image.prompt_data | e }}"
                 data-source-group="{{ image.source_group | default('') }}">
                
                <span class="favorite-star {% if image.is_favorite %}favorited{% endif %}" onclick="toggleFavorite(this, event)">★</span>
                <div class="image-content" onclick="toggleExifData(this)">
                    <img src="/image/{{ image.relative_path }}" alt="{{ image.name }}" loading="lazy">
                    <div class="image-info">
                        <div class="image-name">{{ image.name }}</div>
                        <div class="exif-data"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- أزرار الترقيم -->
        <div class="pagination-controls">
            {% if page > 1 %}
                <a href="{{ url_for('search', q=query, page=page-1, per_page=per_page) }}">→ الصفحة السابقة</a>
            {% else %}
                <span class="disabled">→ الصفحة السابقة</span>
            {% endif %}

            <span class="current-page">صفحة {{ page }} من {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="{{ url_for('search', q=query, page=page+1, per_page=per_page) }}">الصفحة التالية ←</a>
            {% else %}
                <span class="disabled">الصفحة التالية ←</span>
            {% endif %}
        </div>
    {% else %}
        <div class="no-images">لم يتم العثور على نتائج للبحث عن "{{ query }}".</div>
    {% endif %}
</div>
{% endblock %}